# 🧠 Hermora 项目需求文档

---

## 📌 项目概述

Hermora 是一个基于 GMX v2 的加密货币自动策略交易平台，支持用户通过钱包连接（如 MetaMask）进行资金管理、策略配置和自动化交易执行。平台采用前后端分离架构，配合合约系统完成资产与会员权限管理。

---

## 🧱 核心组件概述

### 1. 前端（Next.js + wagmi）

- 支持连接 MetaMask 钱包
- 展示用户状态、资产、策略、会员信息
- 提供交互界面完成资金池操作、策略配置、订阅会员等操作

### 2. 合约系统（Solidity + Hardhat）

| 合约模块             | 功能简介                                            |
| -------------------- | --------------------------------------------------- |
| Vault.sol            | 用户资金池管理，充值/提现、余额记录、手续费收取     |
| Strategy.sol         | 用户策略配置管理，包括交易对、杠杆、止盈止损等      |
| Membership.sol       | 会员订阅与权限管理，支持 USDT 支付与永久会员权限    |
| Fee.sol              | 手续费处理模块，执行交易时收取并转账至 feeCollector |
| MockGMX.sol          | 模拟 GMX 行为的合约，适用于测试交易执行             |
| MockToken.sol        | 测试币，用来本地链上测试资金池，会员交易             |

模块化合约，架构设计方便扩展和部署，配置入口清晰且方便管理。

### 3. 后端执行器（Hermora Executor）

- Node.js 服务端定时运行
- 轮询链上策略配置
- 拉取实时行情（通过 GMX SDK）
- 满足条件时调用合约执行交易（Mock 或 GMX 实盘）

---

## ✅ 项目核心功能需求

### 1. 钱包连接

- 使用 wagmi 实现连接 MetaMask
- 展示钱包地址、网络状态、身份（会员/非会员）、资产余额

---

### 2. 用户资金池（Vault）

- 用户可使用 USDT 存入或取出资金
- 每个用户资金独立账户记录
- 自动收取交易手续费
- 资金调用仅限于策略执行合约调用

---

### 3. 策略配置（Strategy）

- 支持设置参数：
  - 币种（ETH、ARB 等）
  - 杠杆倍数
  - 止盈 / 止损点位
  - 其他参数
- 策略写入链上，支持修改与删除
- Hermora 执行器轮询并执行匹配的策略

---

### 4. 交易执行（Mock + 实盘）

- 本地链部署 MockGMX 模拟交易
- 连接 Arbitrum 上 GMX 实盘合约
- 前端通过网络自动识别调用不同执行接口
- 策略执行成功后记录日志与事件

---

### 5. 会员系统（Membership）

- 用户支付 USDT 成为会员（时长 / 永久）
- 非会员受限于配置策略/资金池数量
- 合约记录会员到期时间，提供只读查询接口
- 支持管理员开通永久会员

---

### 6. 手续费机制（Fee）

- 策略执行扣除手续费
- 自动转账至 feeCollector 钱包地址
- 支持管理员修改手续费比例和接收地址

---

## 🔁 项目交互流程

1. 用户连接钱包（MetaMask）
2. 检查是否为会员（链上判断）
3. 用户充值 USDT 至 Vault
4. 配置策略（币种、杠杆、止盈止损）
5. Hermora 后端定时运行，判断是否触发策略
6. 满足策略 → 调用合约执行交易（Mock / GMX）
7. 扣除手续费 → 转入 feeCollector
8. 用户随时查看状态 / 提现 / 修改策略

---

## 🧪 测试支持

- 市场数据与生产环境通用，调用gmxV2提供的api
- 本地部署 MockGMX 合约进行全链路模拟
- 支持本地 MetaMask 钱包连接（Anvil / Hardhat chain）

---

## 🧰 安全与权限控制

- 所有状态更改操作需调用者为钱包本人
- 管理员可设定：
  - 手续费比例
  - feeCollector 地址
  - 永久会员地址
- 所有合约开放事件记录用于前端监听
- 重要配置写入部署脚本避免手动设置错误

---

## 📅 项目开发阶段

| 阶段 | 功能模块               | 预计时长 | 是否依赖会员系统 |
| ---- | ---------------------- | -------- | ---------------- |
| 1    | 资金池功能与前端打通   | 2~3 天   | ❌               |
| 2    | 策略配置与行情获取     | 3~5 天   | ❌               |
| 3    | 交易执行：Mock + GMX   | 3~4 天   | ✅（策略需限制） |
| 4    | 会员系统与功能权限控制 | 3 天     | ✅               |

---
