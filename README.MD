# Hermes 资金池管理系统

一个基于智能合约的去中心化资金池管理系统，支持用户资金托管、策略管理和自动交易执行。

## 🚀 功能特性

### 资金池管理
- ✅ 用户资金存入和取出
- ✅ 余额查询和锁定机制
- ✅ 最小/最大金额限制
- ✅ 紧急暂停和取出功能

### 策略管理
- ✅ 创建和管理交易策略
- ✅ 支持多种交易标的（ETH、BTC、USDC等）
- ✅ 可配置杠杆、止损、止盈
- ✅ 策略状态管理（激活、暂停、完成）

### 系统特性
- ✅ 智能合约驱动，去中心化架构
- ✅ RESTful API 接口
- ✅ 现代化 Web 界面
- ✅ 实时余额和状态查询

## 📋 系统架构

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端界面      │    │   后端API       │    │   智能合约      │
│   (Web UI)      │◄──►│   (Express)     │◄──►│   (Solidity)    │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                              │                        │
                              ▼                        ▼
                       ┌─────────────────┐    ┌─────────────────┐
                       │   本地网络      │    │   区块链网络    │
                       │   (Hardhat)     │    │   (Ethereum)    │
                       └─────────────────┘    └─────────────────┘
```

## 🛠️ 技术栈

- **智能合约**: Solidity, OpenZeppelin
- **区块链开发**: Hardhat, Ethers.js
- **后端**: Node.js, Express, TypeScript
- **前端**: HTML5, CSS3, JavaScript, Ethers.js
- **开发工具**: TypeScript, pnpm

## 📦 安装和部署

### 1. 安装依赖

```bash
# 安装 pnpm (如果还没有安装)
npm install -g pnpm

# 安装项目依赖
pnpm install
```

### 2. 编译合约

```bash
# 编译智能合约
pnpm compile
```

### 3. 启动本地网络

```bash
# 启动 Hardhat 本地网络
pnpm node
```

### 4. 部署合约

在新的终端窗口中：

```bash
# 部署合约到本地网络
pnpm deploy
```

### 5. 启动后端服务

```bash
# 启动后端 API 服务
pnpm start
```

### 6. 访问前端界面

打开浏览器访问：`http://localhost:3000`

## 🔧 使用说明

### 连接钱包

1. 确保已安装 MetaMask 钱包
2. 点击"连接钱包"按钮
3. 在 MetaMask 中确认连接请求
4. 切换到本地网络（Hardhat Network）

### 资金池操作

#### 存入资金
1. 在"存入资金"区域输入金额
2. 点击"存入资金"按钮
3. 在 MetaMask 中确认交易
4. 等待交易确认

#### 取出资金
1. 在"取出资金"区域输入金额
2. 点击"取出资金"按钮
3. 在 MetaMask 中确认交易
4. 等待交易确认

### 策略管理

#### 创建策略
1. 填写策略名称、交易标的、投资金额等
2. 设置杠杆倍数和交易方向
3. 点击"创建策略"按钮
4. 在 MetaMask 中确认交易

#### 管理策略
- 查看策略列表和状态
- 激活/暂停/取消策略
- 监控策略执行情况

## 📡 API 接口

### 资金池接口

- `GET /api/pool/balance/:userAddress` - 获取用户余额
- `GET /api/pool/total-balance` - 获取池子总余额
- `GET /api/pool/config` - 获取池子配置

### 策略接口

- `GET /api/strategies/:userAddress` - 获取用户策略列表
- `GET /api/strategies/active` - 获取活跃策略列表
- `GET /api/strategies/detail/:strategyId` - 获取策略详情
- `GET /api/strategies/config` - 获取策略配置

### 系统接口

- `GET /api/system/status` - 获取系统状态
- `GET /api/system/contracts` - 获取合约地址

## 🔒 安全特性

- **重入攻击防护**: 使用 OpenZeppelin 的 ReentrancyGuard
- **权限控制**: 基于角色的访问控制
- **暂停机制**: 紧急情况下可暂停合约操作
- **金额限制**: 防止异常大额交易
- **输入验证**: 严格的参数验证

## 📊 合约说明

### AssetPool 合约

用户资金托管合约，主要功能：
- 资金存入和取出
- 余额锁定和解锁
- 用户余额查询
- 紧急操作支持

### StrategyManager 合约

策略管理合约，主要功能：
- 策略创建和配置
- 策略状态管理
- 用户策略查询
- 执行器权限控制

## 🚨 注意事项

1. **测试网络**: 当前配置为本地测试网络，生产环境需要修改网络配置
2. **Gas 费用**: 所有交易都需要支付 Gas 费用
3. **私钥安全**: 请妥善保管私钥，不要在生产环境中使用测试私钥
4. **资金安全**: 建议先使用小额资金测试功能

## 🔄 开发模式

```bash
# 开发模式（自动重启）
pnpm dev:server

# 编译 TypeScript
pnpm build

# 运行测试
pnpm test
```

## 📝 许可证

MIT License

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📞 支持

如有问题，请通过以下方式联系：
- 提交 GitHub Issue
- 发送邮件至项目维护者

---

**免责声明**: 本项目仅供学习和研究使用，请勿用于生产环境。使用本软件的风险由用户自行承担。
